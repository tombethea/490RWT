"use strict";

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js/object/define-property");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.parseJWT = void 0;

function isTokenWithRoles(token) {
  var _token$decoded;

  return !!((_token$decoded = token.decoded) !== null && _token$decoded !== void 0 && _token$decoded.roles);
}

function isTokenWithMetadata(token) {
  var _token$decoded2;

  const claim = token.namespace ? `${token.namespace}/app_metadata` : 'app_metadata';
  return !!((_token$decoded2 = token.decoded) !== null && _token$decoded2 !== void 0 && _token$decoded2[claim]);
}

const appMetadata = token => {
  if (typeof token.decoded === 'string') {
    return {};
  }

  if (isTokenWithMetadata(token)) {
    var _token$decoded3;

    const claim = token.namespace ? `${token.namespace}/app_metadata` : 'app_metadata';
    return (_token$decoded3 = token.decoded) === null || _token$decoded3 === void 0 ? void 0 : _token$decoded3[claim];
  }

  return {};
};

const roles = token => {
  var _metadata$authorizati;

  if (isTokenWithRoles(token)) {
    return token.decoded.roles;
  }

  const metadata = appMetadata(token);
  return (metadata === null || metadata === void 0 ? void 0 : metadata.roles) || ((_metadata$authorizati = metadata.authorization) === null || _metadata$authorizati === void 0 ? void 0 : _metadata$authorizati.roles) || [];
};

const parseJWT = token => {
  return {
    appMetadata: appMetadata(token),
    roles: roles(token)
  };
};

exports.parseJWT = parseJWT;